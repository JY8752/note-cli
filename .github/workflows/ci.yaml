name: Test and Lint

on: [push]

jobs:
  test-and-lint:
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
    runs-on: ${{ matrix.os }}
    steps:
        - uses: actions/checkout@v4
        # Go module cache
        - name: Cache Go modules
          uses: actions/cache@v2
          with:
            path: |
              ~/go/pkg/mod
              ~/go/bin/*
            key: ${{ runner.os }}-go-${{ hashFiles('**/go.sum') }}
            restore-keys: |
              ${{ runner.os }}-go-
        # goのセットアップ
        - name: Set up golang
          uses: actions/setup-go@v4
          with:
            go-version: '>=1.20'
        # staticcheckインストール
        - name: Install staticcheck
          run: |
            if ! command -v staticcheck &> /dev/null
            then
              go install honnef.co/go/tools/cmd/staticcheck@latest
            fi
          shell: bash # Windows環境考慮
        # build
        - name: Build
          run: go build
        # test
        - name: Test
          run: go test ./...
        # 静的解析
        - name: Staticcheck
          run: staticcheck ./...